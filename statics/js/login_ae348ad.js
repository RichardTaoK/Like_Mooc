$(function(){var i=function(){var i=document.location.href.split("backurl=");return i[1]?i[1].split("&")[0]:document.referrer||"/"},t=function(){$(".verify-img").attr("src",imoocSSO.verifyCodeUrl+"?t="+(new Date).getTime()),$(".js-input-verify").val("")},o=function(){"none"==$(".js-verify-row").css("display")&&($(".js-verify-row").show(),$(".verify-img-wrap").append($('<img class="verify-img"/>'))),t()},e={checkName:function(){var i=$(this);/^[0-9]*$/.test(i.val())?i.attr("data-validate","require-mobile-phone"):i.attr("data-validate","require-email")},login:function(){var i=this;if($(".js-error").hide(),!$(this).hasClass("disabled")&&W.validate($(".js-input-name"))&&W.validate($(".js-input-password"))&&W.validate($(".js-input-verify"))){var t={username:$(".js-input-name").val(),password:$(".js-input-password").val(),verify:$(".js-input-verify").val()};$(this).html("正在登录...").attr("disabled","disabled").addClass("disabled"),imoocSSO.login({data:t,success:function(i){if(i.data={userInfo:""},10001==i.status)return void __fireLogined();if(900001==i.status)return void(window.location.href="/user/userfrozen");if(10005==i.status||10007==i.status||90003==i.status)o();else if(10024==i.status)return void(window.location.href="//www.imooc.com/user/checkemail");$(".js-error").show().html(i.msg)},error:function(){$(".js-error").show().html("服务错误，稍后重试")},complete:function(){$(i).html("登录").removeAttr("disabled").removeClass("disabled")}})}}},n=function(){function t(){for(var i in o)i.indexOf("/user")>-1&&(o[i].close&&o[i].close(),o[i]=null,delete o[i])}var o={};return{open:function(e){var n,r;return o[e]&&o[e].closed===!1?void(o[e].focus&&o[e].focus()):(t(),n=(screen.width-600)/2,r=(screen.height-400)/2,void(o[e]=window.open(e+"&referer="+window.location.protocol+"//"+window.location.hostname+"&backurl="+i(),"toolbar=no, directories=no, status=no, menubar=no, width=600, height=500, top="+r+", left="+n)).focus())},clear:t}}(),r=function(){window.__fireLogined=function(){var t=i();window.location.replace(t)},navigator.userAgent.indexOf("MicroMessenger")>-1?($(".js-login-wx").css("display","inline-block"),$("a[data-login-sns]").off("click").each(function(){$(this).attr("href",$(this).attr("data-login-sns")+"&referer="+window.location.protocol+"//"+window.location.hostname+"&backurl="+i())})):$("a[data-login-sns]").click(function(){n.open($(this).attr("data-login-sns"))}),$(".js-showpw").on("click",function(){var i=$(this).prev("input");"password"==i.attr("type")?(i.attr("type","text"),$(this).addClass("imwap-visibility_off")):(i.attr("type","password"),$(this).removeClass("imwap-visibility_off"))}),$(".js-input-name").on("keyup",function(){e.checkName.call(this)}),$(".js-btn-login").on("click",e.login),$(".account-form").on("click",".verify-img",t)},s=function(){imoocSSO.preLogin({error:function(){setTimeout(imoocSSO.preLogin,2e3)}}),r()};s()});